<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Quantiles, Networks, Time - 5&nbsp; Kalman filtering</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./QR.html" rel="next">
<link href="./RegressionLemma.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./intro.html">Methods matter</a></li><li class="breadcrumb-item"><a href="./Kalman.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Kalman filtering</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Quantiles, Networks, Time</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Genesis</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Methods matter</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R2021.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Non-econometric methods for econometricians</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ssm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">State-Space Models: time series models with structure</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./RegressionLemma.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">The regression lemma</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Kalman.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Kalman filtering</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Quantiles</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./QR.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Quantile regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Gibbs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Gibbs Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./CK.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Carter-Kohn</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Networks</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Stemp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Causal Inference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Maps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Mapping regional house price inflation</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Time</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./BK.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Linear rational expectations models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./BVAR.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">BVAR with dummies</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Dynare.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Dynare basics</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">End matter</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Summary</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Appendix1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Basic <code>ggplot2</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./LinAlg.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Linear algebra</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#literature" id="toc-literature" class="nav-link active" data-scroll-target="#literature"><span class="header-section-number">5.1</span> Literature</a>
  <ul class="collapse">
  <li><a href="#reminder-of-a-state-space-model" id="toc-reminder-of-a-state-space-model" class="nav-link" data-scroll-target="#reminder-of-a-state-space-model"><span class="header-section-number">5.1.1</span> Reminder of a state-space model</a></li>
  </ul></li>
  <li><a href="#a-useful-class-of-models" id="toc-a-useful-class-of-models" class="nav-link" data-scroll-target="#a-useful-class-of-models"><span class="header-section-number">5.2</span> A useful class of models</a></li>
  <li><a href="#what-is-a-filter" id="toc-what-is-a-filter" class="nav-link" data-scroll-target="#what-is-a-filter"><span class="header-section-number">5.3</span> What is a filter?</a>
  <ul class="collapse">
  <li><a href="#three-estimation-problems" id="toc-three-estimation-problems" class="nav-link" data-scroll-target="#three-estimation-problems"><span class="header-section-number">5.3.1</span> Three estimation problems</a></li>
  <li><a href="#forecasting" id="toc-forecasting" class="nav-link" data-scroll-target="#forecasting"><span class="header-section-number">5.3.2</span> Forecasting</a></li>
  <li><a href="#uncertainty" id="toc-uncertainty" class="nav-link" data-scroll-target="#uncertainty"><span class="header-section-number">5.3.3</span> Uncertainty</a></li>
  <li><a href="#prediction-error" id="toc-prediction-error" class="nav-link" data-scroll-target="#prediction-error"><span class="header-section-number">5.3.4</span> Prediction error</a></li>
  <li><a href="#current-data-predictions" id="toc-current-data-predictions" class="nav-link" data-scroll-target="#current-data-predictions"><span class="header-section-number">5.3.5</span> Current-data predictions</a></li>
  <li><a href="#estimated-model-covariances" id="toc-estimated-model-covariances" class="nav-link" data-scroll-target="#estimated-model-covariances"><span class="header-section-number">5.3.6</span> Estimated model covariances</a></li>
  </ul></li>
  <li><a href="#the-kalman-filter" id="toc-the-kalman-filter" class="nav-link" data-scroll-target="#the-kalman-filter"><span class="header-section-number">5.4</span> The Kalman filter</a></li>
  <li><a href="#the-kalman-filter-evaluates-the-likelihood" id="toc-the-kalman-filter-evaluates-the-likelihood" class="nav-link" data-scroll-target="#the-kalman-filter-evaluates-the-likelihood"><span class="header-section-number">5.5</span> The Kalman filter evaluates the likelihood</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Kalman filtering</span></h1>
<p class="subtitle lead">Estimating unobserved components</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="literature" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="literature"><span class="header-section-number">5.1</span> Literature</h2>
<p>Alternatives to what follows can be found in <span class="citation" data-cites="Harvey89">Harvey (<a href="references.html#ref-Harvey89" role="doc-biblioref">1989</a>)</span>, <span class="citation" data-cites="Hamilton1994">Hamilton (<a href="references.html#ref-Hamilton1994" role="doc-biblioref">1994</a>)</span>, <span class="citation" data-cites="KimNelson">Kim and Nelson (<a href="references.html#ref-KimNelson" role="doc-biblioref">1999</a>)</span>, <span class="citation" data-cites="Durbin">Durbin and Koopman (<a href="references.html#ref-Durbin" role="doc-biblioref">2001</a>)</span> or <span class="citation" data-cites="BISSM">Triantafyllopoulos (<a href="references.html#ref-BISSM" role="doc-biblioref">2021</a>)</span>. There are many books devoted to the Kalman filter <a href="https://www.amazon.co.uk/s?k=kalman+filtering&amp;i=stripbooks">as a casual Amazon search</a> mostly from an engineering perspective. However econometricians since <span class="citation" data-cites="HarveyPierse">Harvey and Pierse (<a href="references.html#ref-HarveyPierse" role="doc-biblioref">1984</a>)</span> have used it in a way somewhat different from standard engineering applications. We will cover the filter and then look at a simple example if filtering, then develop a maximum likelihood estimation approach.</p>
<section id="reminder-of-a-state-space-model" class="level3" data-number="5.1.1">
<h3 data-number="5.1.1" class="anchored" data-anchor-id="reminder-of-a-state-space-model"><span class="header-section-number">5.1.1</span> Reminder of a state-space model</h3>
<p>Consider the trend-cycle model <span class="math display">\[\begin{equation}
  y_t = \chi_t + \tau_t + \varepsilon_t
\end{equation}\]</span> where the cycle equation is <span class="math display">\[\begin{equation}
  \chi_t = c+\rho_1 \chi_{t-1} + \rho_2 \chi_{t-2}+v_{1t}
\end{equation}\]</span> and the trend equation is <span class="math display">\[\begin{equation}
  \tau_t = \tau_{t-1} + v_{2t}
\end{equation}\]</span></p>
<p>In state space this can be written <span class="math display">\[\begin{align}
y_t &amp;=
\begin{bmatrix} 1 &amp; 0 &amp; 1 \end{bmatrix}
\begin{bmatrix} \chi_t \\ \chi_{t-1} \\ \tau_t \end{bmatrix} + [1] \varepsilon_t\\
\begin{bmatrix} \chi_t \\ \chi_{t-1} \\ \tau_t \end{bmatrix} &amp;=
\begin{bmatrix} c \\ 0 \\ 0 \end{bmatrix} +
\begin{bmatrix} \rho_1 &amp; \rho_2 &amp; 0 \\ 1 &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; 1 \end{bmatrix}
\begin{bmatrix} \chi_{t-1} \\ \chi_{t-2} \\ \tau_{t-1} \end{bmatrix} +
\begin{bmatrix} 1 &amp; 0 \\ 0 &amp; 0 \\ 0 &amp; 1 \end{bmatrix}
\begin{bmatrix} v_{1t} \\ v_{2t} \end{bmatrix}
\end{align}\]</span></p>
</section>
</section>
<section id="a-useful-class-of-models" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="a-useful-class-of-models"><span class="header-section-number">5.2</span> A useful class of models</h2>
<p>We need a framework that nests this type of model (and many more). State-space models are one such framework, amenable to classical (and Bayesian) estimation. Quite a lot of apparatus required before we can apply maximum likelihood.</p>
<p><strong>Key points</strong>:</p>
<ul>
<li>Many quantities routinely used to build models and analyse policy are <em>unobservable</em>.</li>
<li>Econometricians face a major problem estimating such models: everything unobserved needs estimating simultaneously (states and parameters).</li>
<li>Fortunately there is a method we can use: the <strong><em>Kalman filter</em></strong> (<span class="citation" data-cites="Kalman">Kalman (<a href="references.html#ref-Kalman" role="doc-biblioref">1960</a>)</span>).</li>
<li>Has the useful spin-off that we can also use it to calculate the value of the likelihood function.</li>
</ul>
</section>
<section id="what-is-a-filter" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="what-is-a-filter"><span class="header-section-number">5.3</span> What is a filter?</h2>
<p>Imagine we had a time-varying parameter model where we estimate <span class="math inline">\(\beta_t\)</span>; this becomes a time series so we have a lot of parameters to estimate: we outline an estimation method here, which we will then characterise as the <em>Kalman Filter</em>.</p>
<p>Simple observation and transition equations <span class="math display">\[\begin{align}
y_t     &amp;= H_t\beta_t + e_t, &amp;var(e_t) = R \\
\beta_t &amp;= \mu + F \beta_{t-1} + v_t, &amp;var(v_t)=Q
\end{align}\]</span> where <span class="math inline">\(\beta_t\)</span> is a vector of stochastic variables, <span class="math inline">\(y_t\)</span> a vector of measurements and the data forms an information set such that <span class="math inline">\(\psi_T = \{y_T,y_{T-1},...,y_1\}\)</span>.</p>
<p>Note that written this way the shocks are potentially reduced form ones. Typically there will be less shocks then either states (or observables) or it may be that structural shocks enter into one or more relationships. We would then write <span class="math inline">\(e_t = B\eta_t\)</span> and <span class="math inline">\(v_t = G\nu_t\)</span> where <span class="math inline">\(B\)</span> and <span class="math inline">\(G\)</span> are matrices of appropriate dimension that feed the structural shocks into the right equations. If we assume both <span class="math inline">\(eta_t\)</span> and <span class="math inline">\(\nu_t\)</span> only contains independent unit variance shocks, then <span class="math inline">\(R = B\mathbb{E}(\eta_t\eta_t')B' = BB'\)</span> and similarly <span class="math inline">\(Q=GG'\)</span>.</p>
<p>The reason for using the reduced form shocks is toreduce the amount of notation. We will also (to further reduce notation) mostly set <span class="math inline">\(\mu = 0\)</span>, but it is straightforward to have a vector of constants, which we include in the final formulae.</p>
<section id="three-estimation-problems" class="level3" data-number="5.3.1">
<h3 data-number="5.3.1" class="anchored" data-anchor-id="three-estimation-problems"><span class="header-section-number">5.3.1</span> Three estimation problems</h3>
<p><span class="citation" data-cites="Jazwinski">Jazwinski (<a href="references.html#ref-Jazwinski" role="doc-biblioref">1970</a>)</span> defines three type of estimation problem</p>
<ul>
<li><strong>Smoothing</strong> is the problem of estimating <span class="math inline">\(\beta_k\)</span> for any <span class="math inline">\(k&lt;T\)</span></li>
<li><strong>Filtering</strong> is the problem of estimating <span class="math inline">\(\beta_k\)</span> for <span class="math inline">\(k=T\)</span></li>
<li><strong>Prediction</strong> is the problem of estimating <span class="math inline">\(\beta_k\)</span> for any <span class="math inline">\(k&gt;T\)</span></li>
</ul>
<blockquote class="blockquote">
<p>“The object of filtering is to update our knowledge of the system each time a new observation <span class="math inline">\(y_t\)</span> is brought in.” (<span class="citation" data-cites="Durbin">Durbin and Koopman (<a href="references.html#ref-Durbin" role="doc-biblioref">2001</a>)</span>)</p>
</blockquote>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Notation
</div>
</div>
<div class="callout-body-container callout-body">
<p>If we understand the notation we are a long way to understanding the solution. <span class="math display">\[
\begin{align}
\beta_{t|t-1} &amp;= \mathbb{E}[\beta_t | \psi_{t-1}] &amp;&amp; \hbox{Estimate of } \beta_t \hbox{ conditional on } \psi_{t-1} \hbox{ (predicted)} \\
\beta_{t|t}   &amp;= \mathbb{E}[\beta_t | \psi_t]     &amp;&amp; \hbox{Current } (\psi_t) \hbox{ sample estimate} \hbox{ (filtered)}\\
\beta_{t|T}   &amp;= \mathbb{E}[\beta_t | \psi_T]     &amp;&amp; \hbox{Full } (\psi_T) \hbox{ sample estimate} \hbox{ (smoothed)}\\
P_{t|j}       &amp;= \mathbb{E}\left[(\beta_t - \beta_{t|j}) (\beta_t - \beta _{t|j})'\right]  &amp;&amp; \hbox{Conditional cov. based on } \psi_j,\ j=[t-1,t,T]\\
y_{t|t-1}     &amp;= \mathbb{E}[y_t | \psi_{t-1}] = H_t \beta_{t|t-1}  &amp;&amp; \hbox{Prediction of}\ y_t \hbox{ given } \psi_{t-1}\\
\eta_{t|t-1}  &amp;= y_t - y_{t|t-1} = y_t - H_t \beta_{t|t-1}  &amp;&amp; \hbox{Prediction error given }\psi_{t-1} \\
f_{t|t-1}     &amp;= \mathbb{E}[\eta_{t|t-1}\eta_{t|t-1}']      &amp;&amp; \hbox{Conditional } (\psi_{t-1}) \hbox{ variance of prediction error}
\end{align}
\]</span></p>
</div>
</div>
<p>In what follows we will calculate some quantities that are consequences of the state space formulation of our problem that will allow us to apply the regression lemma to estimate the unobserved state variables.</p>
</section>
<section id="forecasting" class="level3" data-number="5.3.2">
<h3 data-number="5.3.2" class="anchored" data-anchor-id="forecasting"><span class="header-section-number">5.3.2</span> Forecasting</h3>
<p>Consider the simple first-order VAR model <span class="math display">\[\begin{equation}
  \beta_t = F\beta_{t-1}+v_{t},\quad v_t\sim N(0,Q)
\end{equation}\]</span> We can use to make the <em>conditional</em> forecast <span class="math display">\[\begin{equation}
  \beta_{t|t-1} = F\beta_{t-1}
\end{equation}\]</span> where <span class="math inline">\(\beta_{t|t-1}= \mathbb{E}[\beta_t|\psi_{t-1}]\)</span> and <span class="math inline">\(\psi_{t-1}\)</span> is the information set available at time <span class="math inline">\(t-1\)</span>.</p>
<p>If <span class="math inline">\(\psi_{t-1}\)</span> includes <span class="math inline">\(\beta_{t-1}\)</span> we can straightforwardly forecast next period (and the next-but-one period etc) using the model. This is a standard forecasting exercise given any estimated (or even calibrated) economic model.</p>
</section>
<section id="uncertainty" class="level3" data-number="5.3.3">
<h3 data-number="5.3.3" class="anchored" data-anchor-id="uncertainty"><span class="header-section-number">5.3.3</span> Uncertainty</h3>
<p>How can we assess the associated forecast uncertainty? The forecast covariance <span class="math inline">\(P_{t|t-1} = var(\beta_t|\psi_{t-1})\)</span> is given by <span class="math display">\[\begin{align*}
P_{t|t-1} &amp;= \mathbb{E}\left[ (\beta_t - \beta_{t|t-1})(\beta_t-\beta_{t|t-1})'\right]   \\
  &amp;= \mathbb{E}\left[ (F\beta_{t-1}+v_t-F\beta_{t-1|t-1}) \left(\beta_{t-1}'F'+v_t'-\beta_{t-1|t-1}'F'\right) \right] \\
&amp;= \mathbb{E}\left[ F\left(\beta _{t-1}-\beta _{t-1|t-1}\right) \left( \beta_{t-1}-\beta _{t-1|t-1}\right) ' F' \right] + \mathbb{E}[v_t v_t'] \\
&amp;= F\mathbb{E}\left[\left(\beta _{t-1}-\beta _{t-1|t-1}\right) \left( \beta_{t-1}-\beta _{t-1|t-1} \right)' \right] F' + \mathbb{E}[v_t v_t'] \\
&amp;= FP_{t-1|t-1}F' + Q
\end{align*}\]</span> where <span class="math inline">\(P_{t-1|t-1} = var(\beta_{t-1}|\psi_{t-1})\)</span>. The forecast error variance depends on the previous error variance; that value depends on the information set.</p>
<p>If <span class="math inline">\(\beta_{t-1}\)</span> forms part of the information set <span class="math inline">\(\psi_{t-1}\)</span> then <span class="math display">\[\begin{equation}
P_{t-1|t-1} = var \left(\beta_{t-1}|\psi_{t-1}\right) = 0
\end{equation}\]</span> and there is no uncertainty other than from the disturbance terms and <span class="math inline">\(P_{t|t-1}=P_t=Q\)</span>.</p>
<p>If <span class="math inline">\(\beta_{t-1}\)</span> does not form part of the information set <span class="math inline">\(\psi_{t-1}\)</span> but <span class="math inline">\(\beta _{t-2}\)</span> does then <span class="math inline">\(P_{t-1|t-1}=Q\)</span> and <span class="math inline">\(P_{t|t-1}=FQF'+Q\)</span>. This can be continued backwards; the unconditional (steady-state) covariance of <span class="math inline">\(\beta_t\)</span> is the limit <span class="math inline">\(P=FPF'+Q\)</span>. We can easily calculate error bands for <span class="math inline">\(\beta_t\)</span> using the appropriate information set.</p>
</section>
<section id="prediction-error" class="level3" data-number="5.3.4">
<h3 data-number="5.3.4" class="anchored" data-anchor-id="prediction-error"><span class="header-section-number">5.3.4</span> Prediction error</h3>
<p>We can turn this around, as it must be the <em>prediction errors</em> are given by <span class="math display">\[\begin{align}
\eta_{t|t-1} &amp;= y_t - \mathbb{E}[y_t|\psi_{t-1}]  \\
             &amp;= y_t - \mathbb{E}[H_t\beta_t+e_t|\psi_{t-1}] \\
             &amp;= y_t-H_t\beta_{t|t-1}
\end{align}\]</span> where <span class="math inline">\(\eta_{t|t-1}\)</span> is uncorrelated with <span class="math inline">\(\psi_{t-1}\)</span>. So the ‘news’ over that contained in <span class="math inline">\(y_t\)</span> above <span class="math inline">\(\psi_{t-1}\)</span> is captured by <span class="math inline">\(\eta_{t|t-1}\)</span>. It will be that <span class="math inline">\(\eta_{t|t-1}\sim N(0,\Sigma_{\eta\eta})\)</span>; we need to find an expression for the covariance.</p>
</section>
<section id="current-data-predictions" class="level3" data-number="5.3.5">
<h3 data-number="5.3.5" class="anchored" data-anchor-id="current-data-predictions"><span class="header-section-number">5.3.5</span> Current-data predictions</h3>
<p>Now we find <span class="math inline">\(\mathbb{E}[\beta_t | \psi_t]\)</span> – the best prediction of the unknown coefficient vector given <em>current</em> information. Using the regression lemma we know that <span class="math display">\[\begin{align}
\mathbb{E}[\beta_t | \psi_t ] &amp;= \mathbb{E}[\beta_t | \psi_{t-1}, \eta_{t|t-1} ]  \\
&amp;= \mathbb{E}[\beta_t | \psi_{t-1}] +\Sigma_{\beta\eta} \Sigma_{\eta\eta}^{-1}\eta_{t|t-1}  \\
&amp;= \beta_{t|t-1} + \Sigma_{\beta\eta}\Sigma_{\eta\eta}^{-1} \eta_{t|t-1}
\end{align}\]</span> because <span class="math inline">\(\psi_{t-1}\)</span> and <span class="math inline">\(\eta_{t|t-1}\)</span> are uncorrelated and <span class="math inline">\(\eta_{t|t-1}\)</span> is mean zero.</p>
<p>Similarly, we can find <span class="math inline">\(P_{t|t}\)</span> as the best prediction of the variance of <span class="math inline">\(\beta_t\)</span> given <span class="math inline">\(\psi_t\)</span>. Using the regression lemma we know that <span class="math display">\[\begin{align}
P_{t|t} &amp;= \mathbb{E}[(\beta_t-\beta_{t|t})(\beta_t - \beta_{t|t})'|\psi_{t-1}, \eta_{t|t-1}] \\
        &amp;= \mathbb{E}[(\beta_t - \beta_{t|t})(\beta_t-\beta_{t|t})'|\psi_{t-1}] - \Sigma_{\beta\eta}\Sigma_{\eta\eta}^{-1}\Sigma_{\eta\beta} \\
        &amp;=P_{t|t-1}-\Sigma_{\beta\eta} \Sigma_{\eta\eta}^{-1} \Sigma_{\eta\beta}
\end{align}\]</span></p>
</section>
<section id="estimated-model-covariances" class="level3" data-number="5.3.6">
<h3 data-number="5.3.6" class="anchored" data-anchor-id="estimated-model-covariances"><span class="header-section-number">5.3.6</span> Estimated model covariances</h3>
<p>All we need do is plug the relevant expressions into the regression lemma. So, what is <span class="math inline">\(\Sigma_{\beta\eta}\)</span>? <span class="math display">\[\begin{align}
\Sigma_{\beta\eta} &amp;= \mathbb{E}[(\beta_t-\beta_{t|t-1}) \eta_{t|t-1}'] \\
&amp;= \mathbb{E}\left[(\beta_t-\beta_{t|t-1}) (y_t-H_t\beta_{t|t-1})'\right] \\
&amp;= \mathbb{E}\left[(\beta_t-\beta_{t|t-1}) (H_t\beta_t+e_t-H_t\beta_{t|t-1})'\right] \\
&amp;= \mathbb{E}[(\beta_t-\beta_{t|t-1}) (\beta_t-\beta_{t|t-1})'H_t'] + \mathbb{E}[(\beta_t - \beta_{t|t-1}) e_t'] \\
&amp;= P_{t|t-1} H_t' \tag{$\Sigma_{\beta\eta}$}
\end{align}\]</span> as <span class="math inline">\(\mathbb{E}[(\beta_t - \beta_{t|t-1})e_t']=0\)</span>.</p>
<p>What is <span class="math inline">\(\Sigma_{\eta\eta}\)</span>? <span class="math display">\[\begin{align}
\Sigma_{\eta\eta} &amp;= \mathbb{E}[(y_t-H_t \beta_{t|t-1})(y_t-H_t\beta_{t|t-1})'] \\
                  &amp;= \mathbb{E}[(H_t\beta_t+e_t-H_t\beta_{t|t-1})(H_t\beta_t+e_t-H_t\beta_{t|t-1})'] \\
                  &amp;= \mathbb{E}[(H_t\beta_t-H_t \beta_{t|t-1})(H_t\beta_t-H_t\beta_{t|t-1})'] + \mathbb{E}[e_t e_t'] \\
                  &amp;= \mathbb{E}[H_t(\beta_t-\beta_{t|t-1})(\beta_t-\beta_{t|t-1})'H_t'] + R \\
                  &amp;= H_t P_{t|t-1} H_t' + R \\
                  &amp;= f_{t|t-1} \tag{$\Sigma_{\eta\eta}$} \label{svv}
\end{align}\]</span> where we define <span class="math inline">\(f_{t|t-1}=\mathbb{E}[\eta_{t|t-1}\eta_{t|t-1}']\)</span>. Now we’re ready.</p>
</section>
</section>
<section id="the-kalman-filter" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="the-kalman-filter"><span class="header-section-number">5.4</span> The Kalman filter</h2>
<p>The equations of the filter are</p>
<ul>
<li>the conditional expectation depending on <span class="math inline">\(\psi_{t-1}\)</span>;</li>
<li>an update that uses <span class="math inline">\(\eta_{t|t-1}\)</span> to obtain the best <span class="math inline">\(t\)</span>-period prediction now based on <span class="math inline">\(\psi_t\)</span>.</li>
</ul>
<p>These must be of the form <span class="math display">\[\begin{align}
\mathbb{E}[\beta_t | \psi_{t-1}] &amp;= \mu + F \mathbb{E} [\beta_t | \psi_{t-1}] \\
\mathbb{E}[P_t|\psi_{t-1}]       &amp;= F \mathbb{E}[P_{t-1}|\psi_{t-1}] F' + Q \\
\mathbb{E}[\beta_t | \psi_t]     &amp;= \mathbb{E}[\beta_t|\psi_{t-1}] + \Sigma_{\beta\eta} \Sigma_{\eta\eta}^{-1}\eta_{t|t-1} \\
\mathbb{E}[P_t|\psi_t]           &amp;= \mathbb{E}[P_t|\psi_{t-1}] -\Sigma_{\beta\eta}\Sigma_{\eta\eta}^{-1}\Sigma_{\eta \beta}
\end{align}\]</span> These are specifically <span class="math display">\[\begin{align}
\beta_{t|t-1} &amp;= \mu +F\beta_{t-1|t-1}                                  &amp;&amp;\hbox{Predicted } \beta \\
P_{t|t-1}     &amp;= F P_{t-1|t-1}F' + Q                                    &amp;&amp;\hbox{Predicted } P \\
\eta_{t|t-1}  &amp;= y_t-H_t\beta_{t|t-1}                                   &amp;&amp;\hbox{Prediction error} \\
f_{t|t-1}     &amp;= H_t P_{t|t-1}H_t' + R                                  &amp;&amp;\hbox{Pred. error variance} \\
\beta_{t|t}   &amp;= \beta_{t|t-1}+P_{t|t-1}H_t' f_{t|t-1}^{-1}\eta_{t|t-1} &amp;&amp;\hbox{Updated } \beta \\
P_{t|t}       &amp;= P_{t|t-1} - P_{t|t-1}H_t' f_{t|t-1}^{-1}H_tP_{t|t-1}   &amp;&amp;\hbox{Updated } P
\end{align}\]</span> The filter evaluates these recursively, beginning from <span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(P_0\)</span>. Treatment of these initial condition reflects knowledge/model:</p>
<ul>
<li>Stationary models can use the steady-state</li>
<li>Non-stationary models use something which is often (confusingly) called a <em>diffuse prior</em> (zero mean, large variance)</li>
</ul>
</section>
<section id="the-kalman-filter-evaluates-the-likelihood" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="the-kalman-filter-evaluates-the-likelihood"><span class="header-section-number">5.5</span> The Kalman filter evaluates the likelihood</h2>
<p>There is an extremely useful spin-off to using the Kalman filter. For <strong><em>known</em></strong> initial conditions – say <span class="math inline">\(\beta_0 = b_0\)</span> – the likelihood of a state-space model with <span class="math inline">\(T\)</span> observations of <span class="math inline">\(m\)</span> variables is <span class="math display">\[\begin{align}
\log L(\theta | y) &amp;= \sum_{t=1}^T \log \left(p (\theta | \psi_{t-1})\right) \\
  &amp;= - \Phi - \frac{1}{2}\sum_{t=1}^T \left( \log(\det(f_{t|t-1})) + \eta_{t|t-1}' f_{t|t-1}^{-1} \eta_{t|t-1} | \psi_{t-1} \right)
\end{align}\]</span> where <span class="math inline">\(\Phi = \frac{Tm}{2}\log \left( 2\pi \right)\)</span> with <span class="math inline">\(\theta\)</span> all the non-state parameters to be estimated. We can use the Kalman filter to obtain <span class="math inline">\(\eta_{t|t-1}\)</span> and <span class="math inline">\(f_{t|t-1}\)</span> as they are the <em>prediction error</em> and its <em>variance</em>. This is the <strong><em>prediction error decomposition</em></strong> of the log-likelihood.</p>
<p>A maximum likelihood estimate maximizes <span class="math inline">\(\log L(\theta | y)\)</span> by choice of <span class="math inline">\(\theta\)</span>.</p>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-Durbin" class="csl-entry" role="listitem">
Durbin, J., and S. J. Koopman. 2001. <em>Time Series Analysis by State Space Methods</em>. Oxford: Oxford University Press.
</div>
<div id="ref-Hamilton1994" class="csl-entry" role="listitem">
Hamilton, J. D. 1994. <em>Time Series Analysis</em>. Princeton, NJ: Princeton University Press.
</div>
<div id="ref-Harvey89" class="csl-entry" role="listitem">
Harvey, Andrew C. 1989. <em>Forecasting, Structural Time Series Models and the Kalman Filter</em>. Cambridge: Cambridge University Press.
</div>
<div id="ref-HarveyPierse" class="csl-entry" role="listitem">
Harvey, Andrew C., and Richard G. Pierse. 1984. <span>“Estimating Missing Observations in Economic Time Series.”</span> <em>Journal of the American Statistical Association</em> 79 (385): 125–31.
</div>
<div id="ref-Jazwinski" class="csl-entry" role="listitem">
Jazwinski, Andrew H. 1970. <em>Stochastic Processes and Filtering Theory</em>. Mineola, N.Y.: Dover Publications Inc.
</div>
<div id="ref-Kalman" class="csl-entry" role="listitem">
Kalman, R. E. 1960. <span>“A New Approach to Linear Filtering and Prediction Problems.”</span> <em>Transactions of the ASME Journal of Basic Engineering</em> 82 (Series D): 35–45.
</div>
<div id="ref-KimNelson" class="csl-entry" role="listitem">
Kim, Chang-Jin, and Charles R. Nelson. 1999. <em>State-Space Models with Regime Switching: Classical and Gibbs-Sampling Approaches with Applications</em>. MIT Press.
</div>
<div id="ref-BISSM" class="csl-entry" role="listitem">
Triantafyllopoulos, Kostas. 2021. <em>Bayesian Inference of State Space Models: Kalman Filtering and Beyond</em>. Springer Texts in Statistics. Cham, Switzerland: Springer.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./RegressionLemma.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">The regression lemma</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./QR.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Quantile regression</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>